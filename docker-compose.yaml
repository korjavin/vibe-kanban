services:
  app:
    image: ghcr.io/korjavin/vibe-kanban:latest
    container_name: ${APP_NAME:-vibe-kanban}
    restart: unless-stopped
    environment:
      - HOST=0.0.0.0
      - PORT=3000
      # Add other environment variables here if needed
      # - POSTHOG_API_KEY=...
      # - POSTHOG_API_ENDPOINT=...
    networks:
      - proxy
    volumes:
      - gh_data:/home/appuser/.config/gh
      - gemini_data:/home/appuser/.gemini
      - repos_data:/repos
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.${APP_NAME:-vibe-kanban}.rule=Host(`${DOMAIN}`)"
      - "traefik.http.routers.${APP_NAME:-vibe-kanban}.entrypoints=websecure"
      - "traefik.http.routers.${APP_NAME:-vibe-kanban}.tls.certresolver=myresolver"
      - "traefik.http.services.${APP_NAME:-vibe-kanban}.loadbalancer.server.port=3000"
      # Conditional Auth Middleware
      # Set AUTH_MIDDLEWARES=auth-errors@docker,forward-auth@docker in Portainer to enable
      - "traefik.http.routers.${APP_NAME:-vibe-kanban}.middlewares=${AUTH_MIDDLEWARES}"

networks:
  proxy:
    name: ${NETWORK}
    external: true

volumes:
  gh_data:
  gemini_data:
  repos_data:
